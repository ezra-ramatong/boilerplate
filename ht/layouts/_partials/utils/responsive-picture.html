{{ $mobileSrc := .mobileSrc }}
{{ $desktopSrc := .desktopSrc }}
{{ $alt := .alt }}
{{ $breakpoint := .breakpoint | default "768px" }}

{{ $mobileImg := resources.Get $mobileSrc }}
{{ $desktopImg := resources.Get $desktopSrc }}

{{ if and $mobileImg $desktopImg }}
  {{ $mobileWebp := $mobileImg.Process "webp" }}
  {{ $desktopWebp := $desktopImg.Process "webp" }}
  <picture>
    {{/* Desktop WebP */}}
    <source
      media="(min-width: {{ $breakpoint }})"
      srcset="{{ $desktopWebp.RelPermalink }}"
      type="image/webp"
    />
    {{/* Desktop JPEG fallback */}}
    <source
      media="(min-width: {{ $breakpoint }})"
      srcset="{{ $desktopImg.RelPermalink }}"
      type="image/jpeg"
    />
    {{/* Mobile WebP */}}
    <source srcset="{{ $mobileWebp.RelPermalink }}" type="image/webp" />
    {{/* Mobile JPEG fallback */}}
    <source srcset="{{ $mobileWebp.RelPermalink }}" type="image/jpeg" />
    {{/* Fallback img */}}
    <img
      src="{{ $mobileImg.RelPermalink }}"
      alt="{{ $alt }}"
      {{ if .width }}width="{{ .width }}"{{ end }}
      {{ if .height }}height="{{ .height }}"{{ end }}
    />
  </picture>
{{ end }}
